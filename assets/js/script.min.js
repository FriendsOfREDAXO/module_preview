let $showModulePreview,slicePosition,slice,$modules,$modulePreview,$close,$body,$html,previewActive=!1,moduleAdded=!1;function showModulePreview(){$.ajax({url:$showModulePreview.eq(0).data("url"),beforeSend:function(){}}).done(function(e){if(e){$modulePreview.find(".inner").html(e),previewActive=!0,$modulePreview.fadeIn(),$body.addClass("module-preview"),$body.css("height","auto"),$html.css("overflow","hidden"),$body.addClass("modal-open"),($modules=$modulePreview.find("a.module")).parent().show();for(let e=0;e<$modules.length;e++){const o=$modules.eq(e).data("href");$modules.eq(e).attr("href",o+"&slice_id="+slice+"#"+slicePosition)}attachModuleEventHandler()}}).fail(function(e,o,i){console.error("script.js:89","  â†´","\n",e,o,i)})}function attachModuleEventHandler(){$modulesSearch=$modulePreview.find("#module-preview-search"),$modulesSearch.length&&$modulesSearch.focus(),$modules.on("click",function(){const e=$(this);moduleAdded=!0,new RegExp("\\bpage="+rex.page+"(\\b[^/]|$)").test(e.attr("href"))&&hideModulePreview()}),$modulesSearch.on("keyup",function(){const e=$modulesSearch.val();e?($modules.parent().hide(),$modules.filter(":icontains("+e+")").parent().show()):$modules.parent().show()});const e=$modulePreview.find("select, input, textarea, button, a"),o=e.first(),i=e.last();i.on("keydown",function(e){9===e.which&&!e.shiftKey&&previewActive&&(e.preventDefault(),o.focus())}),o.on("keydown",function(e){9===e.which&&e.shiftKey&&previewActive&&(e.preventDefault(),i.focus())})}function hideModulePreview(){$modulePreview.fadeOut(function(){previewActive=!1,$body.removeClass("module-preview"),$body.css("height","100%"),$html.css("overflow","initial"),$body.removeClass("modal-open"),$modulePreview.find(".inner").empty(),moduleAdded&&setTimeout(function(){$("#REX_FORM").length&&($("html,body").scrollTop($("#REX_FORM").offset().top),moduleAdded=!1)},10)})}$(document).on("rex:ready",function(){$showModulePreview=$("button.show-module-preview"),$modulePreview=$("#module-preview"),$close=$modulePreview.find(".close"),$body=$("body"),$html=$("html"),hideModulePreview(),$showModulePreview.off("click"),$close.off("click"),$showModulePreview.on("click",function(e){e.preventDefault(),slicePosition=$(this).parents("li").attr("id"),slice=$(this).data("slice"),previewActive?hideModulePreview():showModulePreview()}),$modulePreview.on("click",function(e){const o=$(e.target);(o.hasClass("module-list")||o.parent().hasClass("inner")||"module-preview"===o.attr("id"))&&(e.preventDefault(),e.stopPropagation(),hideModulePreview())}),$close.on("click",function(e){e.preventDefault(),hideModulePreview()}),jQuery.expr[":"].icontains=function(e,o,i){return jQuery(e).text().toUpperCase().indexOf(i[3].toUpperCase())>=0}}),$(document).on("keyup",function(e){"Escape"===e.key&&hideModulePreview()});
